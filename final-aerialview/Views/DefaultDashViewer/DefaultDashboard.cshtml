@* This is a default dashboard that opens in another window with application startup *@
@model List<DashboardDataModel>

@{
    ViewData["Title"] = "Dash Viewer";
    Layout = null;
}

@using DevExpress.AspNetCore
@using DevExpress.DashboardWeb
@using DevExpress.DashboardAspNetCore

<!DOCTYPE html>
<html lang="en">
<head>
    <title>@ViewData["Title"] - AerialView-3.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />
    <link href="~/css/site.min.css" rel="stylesheet" />
    <link href="~/css/ace/ace.bundle.css" rel="stylesheet" />
    <script src="~/js/site.min.js"></script>
    <link href="~/css/dashboard.css" rel="stylesheet" />
    <link rel="icon" href="@Url.Content("~/33477137_AerialView-Logo-5.ico")">
</head>
<body>

    @{
        var hasdashDefault = Model.Any(i => i.DashDefault);
    }

    @if (!hasdashDefault)
    {
        @* default but only should come when no default dashboard is selected  *@
        <div class="text-center position-absolute top-50 start-50 translate-middle fw-medium text-primary-emphasis">
            <span class="d-block">No default dashboard is selected.</span>
            You can select your default dashboard <a href="/Submenu/DashConfig?parentMenu=Dashboard-Admin&submenu=Dash%20Configuration">here</a>.
        </div>
    }
    else
    {
        @foreach (var i in Model)
        {
            if (i.DashDefault == true)
            {
                if (i.DashPath != null)
                {
                    // removing the extension for dashboard viewer syntax
                    string FileNameOnly = @i.DashPath.Substring(0, @i.DashPath.LastIndexOf("."));

                    <div style="position: absolute; left:0;top:0px;right:0;bottom:0;">
                        @(
                            Html.DevExpress().Dashboard("clientDashboardControl")
                            .ControllerName("DefaultDashboard")
                            .Width("100%")
                            .Height("100%")
                            .WorkingMode(WorkingMode.Viewer)
                            .InitialDashboardId(FileNameOnly)
                            .OnBeforeRender("onBeforeRender")
                            )
                    </div>
                }
            }
        }
    }

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        var dashboardControl; // Declare globally

        function onBeforeRender() {
            // Initialize or capture the dashboard control
            dashboardControl = clientDashboardControl;


            setInterval(() => {
                if (dashboardControl) {
                    dashboardControl.reloadData();
                    // dashboardControl.refresh();
                    console.log("Dashboard refreshed");
                }
            }, 5000);
        }
    </script>
   
</body>
</html>
