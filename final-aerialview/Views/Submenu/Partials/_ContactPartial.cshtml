<div class="d-flex justify-content-center p-4">
    <div class="table-responsive">
        <table id="contactTable" class="table table-hover">
            <thead class="border-bottom">
                <tr>
                    <th scope="col" class="border-0 text-center text-primary-emphasis">CId</th>
                    <th scope="col" class="border-0 text-center text-primary-emphasis">Contact Name</th>
                    <th scope="col" class="border-0 text-center text-primary-emphasis">Contact EmailId</th>
                    <th scope="col" class="border-0 text-center text-primary-emphasis">Auto Mail</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var contact in Model)
                {
                    <tr>
                        <td class="text-center align-middle">@contact.CId</td>
                        <td class="w-25">
                            <input type="text" class="form-control form-control-sm border-0 text-center text-dark fw-bold text-capitalize p-1" value="@contact.ContactName">
                        </td>
                        <td class="w-25">
                            <input type="text" class="form-control form-control-sm border-0 text-center text-dark fw-bold p-1" value="@contact.ContactEmailId">
                        </td>
                        <td class="text-center w-25">
                            <div class="form-check d-flex justify-content-center">
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault1" @(contact.AutoMail ? "checked" : "")>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="card-footer border-dark-subtle d-flex align-items-center justify-content-end gap-1">
    <button type="button" class="btn bg-primary-subtle btn-sm border-primary-subtle shadow fw-medium mr-auto" id="btnAddContact" onclick="insertRow()"><i class="ri-add-line"></i> Add Contact</button>
    <button type="button" class="btn bg-success-subtle btn-sm border-success-subtle shadow fw-medium mr-2"><i class="ri-save-line"></i> Save</button>
    <button id="contactTable" type="button" class="btn bg-danger-subtle btn-sm border-danger-subtle shadow fw-medium"><i class="ri-delete-bin-7-line"></i> Cancel</button>
</div>

<script>
    // Array to store original contact data for discarding changes
    var originalContacts = @Html.Raw(Json.Serialize(Model));

    // Function to restore original data in the form
    function restoreOriginalValues() {
        var contactTable = document.getElementById('contactTable').getElementsByTagName('tbody')[0];
        var rows = contactTable.getElementsByTagName('tr');

        for (var i = 0; i < rows.length; i++) {
            var cells = rows[i].getElementsByTagName('td');

            // Restore values from originalContacts array
            cells[1].querySelector('input').value = originalContacts[i].ContactName;
            cells[2].querySelector('input').value = originalContacts[i].ContactEmailId;
            var checkbox = cells[3].querySelector('input[type="checkbox"]');
            checkbox.checked = originalContacts[i].AutoMail;
        }
    }

    // Array to store IDs of newly added rows for easy removal
    var newRowsIds = [];

    function insertRow() {
        var contactTable = document.getElementById('contactTable').getElementsByTagName('tbody')[0];

        // Create a new row
        var newRow = contactTable.insertRow();

        // CId cell (leave empty for automatic population)
        newRow.insertCell(0).className = 'text-center align-middle';

        // Contact Name cell
        var newNameCell = newRow.insertCell(1);
        newNameCell.className = 'w-25';
        newNameCell.innerHTML = '<input type="text" class="form-control form-control-sm border-0 text-center text-dark fw-bold text-capitalize p-1" value="">';

        // Contact EmailId cell
        var newEmailCell = newRow.insertCell(2);
        newEmailCell.className = 'w-25';
        newEmailCell.innerHTML = '<input type="text" class="form-control form-control-sm border-0 text-center text-dark fw-bold p-1" value="">';

        // Auto Mail cell
        var newAutoMailCell = newRow.insertCell(3);
        newAutoMailCell.className = 'text-center w-25';
        newAutoMailCell.innerHTML = '<div class="form-check d-flex justify-content-center"><input class="form-check-input" type="checkbox" value=""></div>';

        // Add new row ID to the array
        newRowsIds.push(newRow.rowIndex);
    }

    function saveContacts() {
       
        alert('Saving functionality not implemented yet.');
    }

    function cancelEdits() {
        restoreOriginalValues();

        var contactTable = document.getElementById('contactTable').getElementsByTagName('tbody')[0];

        // Loop through newRowsIds and remove rows
        for (var i = newRowsIds.length - 1; i >= 0; i--) {
            contactTable.deleteRow(newRowsIds[i]);
        }

        // Clear the newRowsIds array
        newRowsIds = [];
    }
</script>


